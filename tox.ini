[tox]
envlist = static-analysis,test,integration-test
skipsdist = True
usedevelop = True
recreate = False

[testenv]
allowlist_externals =
    bash

[testenv:normalize]
description = Runs autopep8 on this project
deps =
  black==22.10.0
  autopep8==1.7.0
commands =
  bash -c "black {toxinidir}/src"
  bash -c "black {toxinidir}/tests"
  bash -c "autopep8 --recursive --in-place {toxinidir}/src"
  bash -c "autopep8 --recursive --in-place {toxinidir}/tests"

[testenv:check]
description = Runs type-checking (pyright) on this project
deps =
  pyright==1.1.290
commands =
  bash -c "pyright {toxinidir}/src"

[testenv:utest]
deps =
  -e .[testing]
description=Unit tests
install_command=
  python -m pip install {packages}
commands =
    pytest --capture=tee-sys tests/units

[testenv:itest]
deps =
  .[testing]
description=Integration tests
install_command=
  python -m pip install {packages}
commands =
     pytest --capture=tee-sys tests/integration

[testenv:static-analysis]
description = Runs staitc-analysis tools on this project
skip_install = True
recreate = False
deps =
	flake8==5.0.4
  vulture==2.6
commands =
  bash -c "vulture {toxinidir}/src --exclude */bin/* || true"
  bash -c "vulture {toxinidir}/tests || true"
  flake8 --config {toxinidir}/.flake8 src/
  flake8 --config {toxinidir}/.flake8 tests
